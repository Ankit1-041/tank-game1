# Configuration

## CLI

You can configure JsBattle by providing shell arguments on startup. To get more information run

```bash
./jsbattle.js --help
```

## Configuration file
Most of the configuration is done via a configuration file.

```bash
./jsbattle.js start --config jsbattle.config.json
```

When the config file is not provided, the default configuration is applied. If any value is missing in the config file, default settings are used. CLI arguments have a higher priority than settings from the config file.  

## Full configuration file
List of all settings of JsBattle:

```js
{
  // supported log levels: "error", "warn", "info", "debug", "trace"
  "loglevel": "info",

  // do not inject config data from environmental variables"
  "skipEnv": false,

  // data persistence settings
  "data": {

    // name of db adapter. See DB Adapters section for more details
    "adapter": "nedb"

    // path to directory where the data is stored. When not provided, an in-memory DB is used
    "path": "./jsbattle-data"
  },

  // configuration of web server
  "web": {

    // path to static files. In most cases you do not need to change that
    "webroot": path.resolve(__dirname, "./public"),

    // host where web server will bind to
    "host": "127.0.0.1",

    // port where web server will bind to
    "port": "8080",

    // url where JsBattle is available. Required to generate URL links properly (e.g. oAth callback)
    "baseUrl": "http://localhost:8080",

      // Configures the Access-Control-Allow-Origin CORS header.
    "corsOrigin": ["http://localhost:8080"],

    // Google Analytics code (stats are disabled when not provided)
    "gaCode": ""
  },

  // authorization settings
  "auth": {

    // if auth is disabled, login will not be required. It is not recommended for production
    // since it will result in exposing admin panel to public. Some features may be disabled
    // when auth is turned off
    "enabled": true,

    // list of users that will be granted administration permissions (admin role)
    "admins": [
      {
        "provider": "github",
        "username": "thejack6318"
      }
    ],

    // list of OAuth providers. For each providers there are two routes created:
    // - /auth/{provider_name} - redirects to provider login page
    // - /auth/{provider_name}/callback - retrieve oAuth token from provider
    "providers": [

      // define each provider as separate object
      {
        // name of provider. Supported values are: github, facebook, google
        // authStrategies['github'] = require("passport-github2");
        "name": 'github',

        // client ID generated by OAuth provider
        "clientID": "XXXXXXXXXXXXXXXXXXXX",
        // client secret generated by OAuth provider
        "clientSecret": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
      }
    ]
  }
}
```

### DB Adapters

### NeDb
```js
{
  // name of the adapter
  "adapter": "nedb",

  // path to directory where the data is stored. When not provided, an in-memory DB is used
  "path": "./jsbattle-data"
}
```

### MongoDB
```js
{
  // name of the adapter
  "adapter": "mongo",

  // DB connection string
  "uri": "mongodb://localhost/jsbattle",

  // Options passed to Mongo Client
  "options": {

    // example:
    "useUnifiedTopology": true
  }
}
```

## Environment variables

Part of the configuration could be provided as env vars. To disable this feature set `config.skipEnv` to `true`;

### OAuth providers
To configure OAuth provider set up following env vars

```bash
OAUTH_{PROVIDER_NAME}_CLIENT_ID=XXXXXXXXXXXXXXXXXXXX
OAUTH_{PROVIDER_NAME}_CLIENT_SECRET=XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

Where `{PROVIDER_NAME}` is one of supported providers (upper case)
